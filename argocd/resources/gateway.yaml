apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: argocd-gateway
  namespace: argocd
spec:
  gatewayClassName: cilium
  listeners:
  # - protocol: HTTP
  #   port: 1080
  #   name: web-gw
  #   allowedRoutes:
  #     namespaces:
  #       from: All
  - protocol: TLS
    port: 1443
    name: web-gw-tls
    tls:
      mode: Passthrough
    allowedRoutes:
      namespaces:
        from: All
---
# apiVersion: gateway.networking.k8s.io/v1
# kind: HTTPRoute
# metadata:
#   name: argocd-route
#   namespace: argocd
# spec:
#   parentRefs:
#     - name: argocd-gateway
#   rules:
#   - backendRefs:
#       - name: argocd-prd-server  
#         port: 80

apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TLSRoute
metadata:
  name: argocd-route
  namespace: argocd
spec:
  parentRefs:
    - name: argocd-gateway
  rules:
  - backendRefs:
      - name: argocd-prd-server  
        port: 443



# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: gwapi-ingress
#   namespace: argocd
#   annotations:
#     alb.ingress.kubernetes.io/scheme: internet-facing
#     alb.ingress.kubernetes.io/target-type: ip
# spec:
#   ingressClassName: alb
#   rules:
#     - http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: cilium-gateway-argocd-gateway
#                 port:
#                   number: 80
# ---
# # apiVersion: networking.k8s.io/v1
# # kind: Ingress
# # metadata:
# #   name: argocd-ingress
# #   namespace: argocd
# #   annotations:
# #     alb.ingress.kubernetes.io/scheme: internet-facing
# #     alb.ingress.kubernetes.io/target-type: instance
# # spec:
# #   ingressClassName: alb
# #   rules:
# #     - http:
# #         paths:
# #           - path: /
# #             pathType: Prefix
# #             backend:
# #               service:
# #                 name: argocd-prd-server
# #                 port:
# #                   number: 80

# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: argocd-nlb
#   namespace: argocd
#   annotations:
#     service.beta.kubernetes.io/aws-load-balancer-type: "external" 
#     service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "instance"
# spec:
#   type: LoadBalancer
#   externalTrafficPolicy: Cluster  # Permite tr√°fego externo via Load Balancer
#   ports:
#     - name: http
#       port: 80
#       targetPort: 80
#       protocol: TCP
#     - name: https
#       port: 443
#       targetPort: 443
#       protocol: TCP
#   selector:
#     app.kubernetes.io/name: argocd-server
